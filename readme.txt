This is the core api of master.
All codes are rewritten to be more simple and efficient.
